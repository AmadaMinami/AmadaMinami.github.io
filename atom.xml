<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>9th Patient</title>
  
  <subtitle>ようこそ、私の世界へ！</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://www.j2kly.com/"/>
  <updated>2021-02-23T04:42:35.755Z</updated>
  <id>https://www.j2kly.com/</id>
  
  <author>
    <name>9th Patient</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>乘风破浪，去黑暗</title>
    <link href="https://www.j2kly.com/2021/02/22/Year-2021/"/>
    <id>https://www.j2kly.com/2021/02/22/Year-2021/</id>
    <published>2021-02-22T08:28:01.000Z</published>
    <updated>2021-02-23T04:42:35.755Z</updated>
    
    <content type="html"><![CDATA[<h3 id="以日以年"><a href="#以日以年" class="headerlink" title="以日以年"></a>以日以年</h3><p>&ensp;&ensp;&ensp;&ensp;去年这个词，大概应该算是古汉语，在白居易的《琵琶行》就有出现。白居易的口中的去年，是词中的去年。而我的去年是一场匆忙的完成所谓“人生大事”的去年。结婚、买房、千里换工作。按照家里长辈的话来说，每一样都是一不小心就会毁了人生的事情。时间越来越快，离三十岁越来越近，我却越来越着急。心里面虽然没有对于物质特别强烈的要求，当没有钱的时候，是最没有安全感的时候。我本来想在近期开始写日记，一方面可以记录自己的生活，一方面也想做留下自己在这个世界的痕迹。对啊，都快忘记自己最初的想法了。人活一次，在稻盛和夫的《活法》中，也说的比较明确，就是提升自己的灵魂。而我，想在这个世界留下自己来过的痕迹，不想被这个世界所遗忘。在去年，我依然没有达到这个目标。曾经很多次思考过，要达到这个目标，我应该怎么做才能把自己的生活给记录下来。比如《SAO》中的夹在肩膀的摄像头，拍摄存储，又或者撸日记本。但是貌似都难以坚持下来，对人的意志力是一种极大的考验。倘若能够坚持下来，也不会被宋老师叫小胖了。总是忘记了自己是如何坚持撸代码撸下来的，也不知道自己为什么换了个事情，就坚持不下来。很羡慕身边有的人能够按照自己的想法去过好自己想要的一生，我虽然也保有自由的观念，无奈做不到完全的自由。换句话来说，自由始终是有代价的，想要获取一定的自由，那么肯定要付出。</p><p>&ensp;&ensp;&ensp;&ensp;知道的是，时间是一把双刃剑，它不光能够给你带来荣耀，也能毁灭一个人。只要搭上了时间这班车，任何人都没有办法将其暂停哪怕一秒。所以既然如此，都是活在时间这班列车中，为何不利用好它。假设每天写一篇日记，一年下来，那将是一本书的厚度。几十年，就是几十本。所谓人生，不就是在写自己吗？</p><h3 id="瘦"><a href="#瘦" class="headerlink" title="瘦"></a>瘦</h3><p>&ensp;&ensp;&ensp;&ensp;目标已经定下来了，也体验够了做胖子的感觉。每个月瘦三斤就可以达到自己的目标。奖励是一块OMEGA。暂时制定每天的一下目标：</p><ul><li>跳绳1000个，如果没有半小时，就持续半小时</li><li>做做体操？</li></ul><p>其实我没有想要获得OMEGA，只是想要战胜自己。</p><p>乘风破浪，去黑暗走一趟。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;以日以年&quot;&gt;&lt;a href=&quot;#以日以年&quot; class=&quot;headerlink&quot; title=&quot;以日以年&quot;&gt;&lt;/a&gt;以日以年&lt;/h3&gt;&lt;p&gt;&amp;ensp;&amp;ensp;&amp;ensp;&amp;ensp;去年这个词，大概应该算是古汉语，在白居易的《琵琶行》就有出现。白居易的口中的
      
    
    </summary>
    
      <category term="修身" scheme="https://www.j2kly.com/categories/%E4%BF%AE%E8%BA%AB/"/>
    
    
      <category term="年度总结" scheme="https://www.j2kly.com/tags/%E5%B9%B4%E5%BA%A6%E6%80%BB%E7%BB%93/"/>
    
      <category term="新年快乐" scheme="https://www.j2kly.com/tags/%E6%96%B0%E5%B9%B4%E5%BF%AB%E4%B9%90/"/>
    
  </entry>
  
  <entry>
    <title>Andorid模拟器桥接网络通信</title>
    <link href="https://www.j2kly.com/2020/01/09/Andorid%E6%A8%A1%E6%8B%9F%E5%99%A8%E6%A1%A5%E6%8E%A5%E7%BD%91%E7%BB%9C%E9%80%9A%E4%BF%A1/"/>
    <id>https://www.j2kly.com/2020/01/09/Andorid模拟器桥接网络通信/</id>
    <published>2020-01-09T15:03:01.000Z</published>
    <updated>2021-02-07T09:07:06.334Z</updated>
    
    <content type="html"><![CDATA[<p>最近研究的项目，是以一个需要Andorid模拟器与宿主机通信的案例。其中通过查阅<a href="https://developer.android.google.cn/studio/run/emulator-networking?hl=zh-cn" target="_blank" rel="noopener">google官方文档</a>发现了两种进行网络通信的方式。正常情况下，andorid模拟器有自带一个网关，产生了一个局域网。andorid躲在这个网关背后。所以无法正常获取到与宿主机相同的网段ip，也就无法正常与宿主机。google提供的方法有两种方法：</p><ul><li><p>通过模拟器控制台设置重定向，即将andorid的网络端口按照<code>tcp/udp:andorid</code>机端口:宿主机端口进行重定向。各自使用对应的localhost端口进行通信。</p></li><li><p>通过adb进行网络端口转发，使用<code>adb forward tcp:6100 tcp:7100</code>进行端口转发，和模拟器控制台进行重定向差不多，但是……</p><blockquote><p>“除了通过终止adb服务器来移除重定向以外，adb目前不提供任何移除重定向的方法。”</p></blockquote></li></ul><p>google官方文档这样写着。</p><p>其实这两种有种很大的弊端，google官方从应用设计的角度去考虑了，但不能满足应用开发者所要用到所有要求。即，当应用需要使用10+以上数量端口的时候，使用端口映射或许会使使用者变得焦虑无比，从而放弃。但庆幸，qemu的设计者并没有这么愚顿。emulator存在一个<code>-nap-tap</code>选项，用于满足使用tap的情形。也就是说，这将成为第三种给Andorid系统接入网络的方式。</p><h2 id="进行准备工作"><a href="#进行准备工作" class="headerlink" title="进行准备工作"></a>进行准备工作</h2><hr><p>使用的实验环境：</p><ul><li>Ubuntu18.04</li><li>Android emulator version 29.3.4.0 (build_id 6110076) (CL:N/A)</li><li>Android10(Q)</li></ul><p>查看系统支持：<br>qemu 支持多种网络链接方式，其中最常用的就是桥接(bridge)。 这需要依赖内核的 tun/tap 模块的支持，输入如下命令查看<code>/dev/net/tun</code>文件。</p><pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">ls</span> -l /dev/net/tun crw-rw-rwT 1 root root 10, 200 Apr 15 02:23 /dev/net/tun<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>如果存在，说明内核已经支持</p><p>安装必须的工具：</p><pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># 虚拟网桥工具</span><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> uml-utilities<span class="token comment" spellcheck="true"># UML（User-mode linux）工具</span><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> bridge-utils<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="创建网桥"><a href="#创建网桥" class="headerlink" title="创建网桥"></a>创建网桥</h2><hr><p>针对创建网桥的方式，根据如图所示</p><p><img src="https://s2.ax1x.com/2020/01/09/lfN5dJ.png" class="img-shadow"></p><p>eth0为所使用的物理网卡,tap0为使用的虚拟网卡，br0为搭建在eth0上的网桥。需要注意的是，eth0在你的PC上可能为其他的名字，比如ens9等等。还有一点，创建网桥必须在有线网卡之上，否则不能将接口添加到br0中。（经过我的测试，无线网卡不支持，如果有办法添加，再更新此篇）。</p><p>下面以一个脚本up.sh来说明创建过程</p><pre class="line-numbers language-bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span><span class="token function">sudo</span> <span class="token function">ifconfig</span> ens9 down <span class="token comment" spellcheck="true"># 除能有线网卡</span><span class="token function">sudo</span> brctl addbr br0    <span class="token comment" spellcheck="true"># 添加网桥</span><span class="token function">sudo</span> brctl addif br0 ens9 <span class="token comment" spellcheck="true"># 添加有线网卡到网桥</span><span class="token function">sudo</span> brctl stp br0 off <span class="token comment" spellcheck="true"># 不需要STP(生成树协议)</span><span class="token function">sudo</span> brctl setfd br0 1 <span class="token comment" spellcheck="true"># 设置网桥转发延迟</span><span class="token function">sudo</span> brctl sethello br0 1 <span class="token comment" spellcheck="true"># 设置网桥hello时间</span><span class="token function">sudo</span> <span class="token function">ifconfig</span> br0 0.0.0.0 promisc up  <span class="token comment" spellcheck="true"># 混杂模式启动网桥</span><span class="token function">sudo</span> <span class="token function">ifconfig</span> ens9 0.0.0.0 promisc up <span class="token comment" spellcheck="true"># 混杂模式启动有线网卡</span><span class="token function">sudo</span> dhclient br0 <span class="token comment" spellcheck="true"># 自动获取网桥ip</span><span class="token function">sudo</span> <span class="token function">ifconfig</span> br0 192.168.31.22 netmask 255.255.255.0 <span class="token comment" spellcheck="true"># 配置网桥的ip地址和掩码</span><span class="token function">sudo</span> route add -net 0.0.0.0 netmask 0.0.0.0 gw 192.168.31.1 <span class="token comment" spellcheck="true"># 添加网关信息</span><span class="token comment" spellcheck="true"># 这里的ip地址和gateway，需要根据实际情况进行设置</span><span class="token comment" spellcheck="true"># 创建tap</span><span class="token function">sudo</span> tunctl -t tap0 -u user <span class="token comment" spellcheck="true"># 为用户user添加tap0，此处的user，填写自己的linux账户名</span><span class="token function">sudo</span> brctl addif br0 tap0 <span class="token comment" spellcheck="true"># 添加tap0到网桥</span><span class="token function">sudo</span> <span class="token function">ifconfig</span> tap0 0.0.0.0 promisc up <span class="token comment" spellcheck="true"># 混杂模式启动tap0</span><span class="token function">sudo</span> brctl showstp br0 <span class="token comment" spellcheck="true"># 打印一下网桥的信息</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>下面以一个脚本down.sh来说明反创建过程</p><pre class="line-numbers language-bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span> <span class="token comment" spellcheck="true"># adb会占用/dev/net/tun，导致后面的步骤失效，先杀掉</span><span class="token function">kill</span> -9 <span class="token variable"><span class="token variable">$(</span>pidof adb<span class="token variable">)</span></span> <span class="token function">sudo</span> <span class="token function">ifconfig</span> tap0 down <span class="token function">sudo</span> tunctl -d tap0 <span class="token comment" spellcheck="true"># 删除tap0</span><span class="token function">sudo</span> <span class="token function">ifconfig</span> ens9 down<span class="token function">sudo</span> <span class="token function">ifconfig</span> br0 down<span class="token function">sudo</span> brctl delbr br0 <span class="token comment" spellcheck="true"># 删除网桥</span><span class="token function">sudo</span> <span class="token function">ifconfig</span> ens9 up<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="启动模拟器"><a href="#启动模拟器" class="headerlink" title="启动模拟器"></a>启动模拟器</h2><hr><p>仍然以脚本start_emulator来说明</p><pre class="line-numbers language-bash"><code class="language-bash"><span class="token shebang important">#!/bin/bash</span><span class="token comment" spellcheck="true"># 设置环境</span><span class="token function">export</span> LD_LIBRARY_PATH<span class="token operator">=</span>/home/user/Android/Sdk/emulator/lib64/qt/lib:/home/user/Android/Sdk/emulator/lib64/home/user/Android/Sdk/emulator/qemu/linux-x86_64/qemu-system-x86_64 \    -netdelay none \    -netspeed full \    -avd Lark_API_29 \    -net-tap tap0 <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>其中<code>-net-tap0</code>即为使用刚刚创建好的tap0，这样进入android系统的时候，使用<code>adb shell</code>打开shell后，<code>ifconfig -a</code>，查看ip地址的时候，就可以发现，已经和宿主机是相同的ip地址了。互相ping一下，也能ping通。说明，andorid模拟器已经成为与宿主机同级网络下的一个终端机了。</p><p>上述环境所使用的android镜像是通过android studio下载安装的andorid镜像。</p><h2 id="但是"><a href="#但是" class="headerlink" title="但是"></a>但是</h2><hr><p>很不幸运，上面所说的，在自己下载android源码并编译的系统镜像下，并不完全适用。需要修改的是以下几点。</p><ul><li>默认关闭wifi网卡</li><li>使用刚刚创建好的脚本自动执行虚拟网卡的创建与删除</li><li>打通内外ip</li></ul><p>首先，默认关闭wifi网卡。在模拟器启动参数中添加：</p><pre class="line-numbers language-bash"><code class="language-bash">-feature -Wifi<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>这样android模拟器才会使用所指定的tap0，否则获取到的ip为192.168.200.2这样一个奇怪的ip。是一个二级网络中的ip。</p><p>使用创建好的up.sh和down.sh，在模拟器启动参数中添加：</p><pre class="line-numbers language-bash"><code class="language-bash">    -net-tap-script-up <span class="token variable">$scriptsdir</span>/up.sh \    -net-tap-script-down <span class="token variable">$scriptsdir</span>/down.sh<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>此处的<code>$scriptsdir</code>为这两个脚本存在的目录。</p><p>这样启动模拟器后，可能还是会存在一个问题，就是无法与外界ping通，但是ip是正确被设置了。</p><pre><code>tcpdump -i eth0 # eth0为andorid系统内的网卡</code></pre><p>这样看应该能够看到一些在滚动的数据，这个时候只需要在adb shell中执行</p><pre><code>ip rule add from all lookup main pref 0</code></pre><p>这样即可达到互相ping一下，也能ping通的效果了，也就完成了Andorid模拟器与宿主机通信的问题了。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;最近研究的项目，是以一个需要Andorid模拟器与宿主机通信的案例。其中通过查阅&lt;a href=&quot;https://developer.android.google.cn/studio/run/emulator-networking?hl=zh-cn&quot; target=&quot;_bl
      
    
    </summary>
    
      <category term="技术" scheme="https://www.j2kly.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="Android" scheme="https://www.j2kly.com/tags/Android/"/>
    
      <category term="Emulator" scheme="https://www.j2kly.com/tags/Emulator/"/>
    
  </entry>
  
  <entry>
    <title>如何解码PCM</title>
    <link href="https://www.j2kly.com/2019/02/19/%E5%A6%82%E4%BD%95%E8%A7%A3%E7%A0%81PCM/"/>
    <id>https://www.j2kly.com/2019/02/19/如何解码PCM/</id>
    <published>2019-02-19T15:47:31.000Z</published>
    <updated>2021-02-07T09:07:06.335Z</updated>
    
    <content type="html"><![CDATA[<p><img src="https://s2.ax1x.com/2019/02/20/kgvqhQ.png" class="img-shadow"></p><p>通常使用三个参数来表示声音，<code>量化位数</code>、<code>取样频率</code>、<code>采样点振幅</code>。<br>量化位数分为<code>8位</code>、<code>16位</code>、<code>24位</code>三种，声道有<code>单声道</code>和<code>立体声</code>之分。<br>单声道振幅数据为n <em> 1矩阵点，立体声为n </em> 2矩阵点，取样频率一般有<code>11025Hz(11kHz)</code>，<code>22050Hz(22kHz)</code>，<code>44100Hz(44kHz)</code>三种。<br>大概了解<a href="https://baike.baidu.com/item/%E9%9F%B3%E9%A2%91%E9%87%87%E6%A0%B7/446474" target="_blank" rel="noopener">音频采样</a>即可。<br>主要明白，就是把传感器（麦克风）在某瞬间（某周期内，用取样频率算）的电压值采集进来，用ADC转换成对应的数字位数存下来，就是采样量化了。</p><h2 id="WAV文件是什么"><a href="#WAV文件是什么" class="headerlink" title="WAV文件是什么"></a>WAV文件是什么</h2><hr><p>WAV为微软公司（Microsoft)开发的一种声音文件格式，它符合RIFF(Resource Interchange File Format)文件规范。<br>用于保存Windows平台的音频信息资源，被Windows平台及其应用程序所广泛支持，该格式也支持MSADPCM、CCITT A LAW等多种压缩运算法。<br>支持多种音频数字，取样频率和声道，标准格式化的WAV文件和CD格式一样，也是44.1K的取样频率，16位量化数字，因此在声音文件质量和CD相差无几！<br>WAV打开工具是WINDOWS的媒体播放器。</p><p>不过尽管音质出色，但在压缩后的文件体积过大！相对其他音频格式而言是一个缺点。<br>其文件大小的计算方式为:WAV格式文件所占容量</p><blockquote><p>（B) = （取样频率 X量化位数X 声道） X 时间 / 8 (字节 = 8bit)</p></blockquote><p>每一分钟WAV格式的音频文件的大小为10MB，其大小不随音量大小及清晰度的变化而变化。<br>WAV是最接近无损的音乐格式，所以文件大小相对也比较大。</p><p>所有的WAV都有一个文件头，这个文件头音频流的编码参数。<br>数据块的记录方式是little-endian字节顺序，标志符并不是字符串而是单独的符号。<br>所谓的little-endian就是小端序，举个例子:<br>0x55AA，这样一个16bit的数据，在WAV文件中存储的形式就是 : AA 55<br>所以在使用这个数据的时候， 需要将</p><pre class="line-numbers language-c"><code class="language-c">data <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0x55</span> <span class="token operator">&lt;&lt;</span> <span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token punctuation">(</span><span class="token number">0xAA</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>如果采样频率是8bit的，就不用转换了。</p><p>关于WAV文件头格式</p><table><thead><tr><th style="text-align:center">偏移地址</th><th style="text-align:center">大小</th><th style="text-align:center">数据块类型</th><th style="text-align:center">内容</th></tr></thead><tbody><tr><td style="text-align:center">00H~03H</td><td style="text-align:center">4</td><td style="text-align:center">4字符</td><td style="text-align:center">资源交换文件标志（RIFF）</td></tr><tr><td style="text-align:center">04H~07H</td><td style="text-align:center">4</td><td style="text-align:center">长整数</td><td style="text-align:center">从下个地址开始到文件尾的总字节数</td></tr><tr><td style="text-align:center">08H~0BH</td><td style="text-align:center">4</td><td style="text-align:center">4字符</td><td style="text-align:center">WAV文件标志（WAVE）</td></tr><tr><td style="text-align:center">0CH~0FH</td><td style="text-align:center">4</td><td style="text-align:center">4字符</td><td style="text-align:center">波形格式标志（fmt ），最后一位空格</td></tr><tr><td style="text-align:center">10H~13H</td><td style="text-align:center">4</td><td style="text-align:center">整数</td><td style="text-align:center">过滤字节（一般为00000010H）</td></tr><tr><td style="text-align:center">14H~15H</td><td style="text-align:center">2</td><td style="text-align:center">整数</td><td style="text-align:center">格式种类（值为1时，表示数据为线性PCM编码）</td></tr><tr><td style="text-align:center">16H~17H</td><td style="text-align:center">2</td><td style="text-align:center">整数</td><td style="text-align:center">通道数，单声道为1，双声道为2</td></tr><tr><td style="text-align:center">18H~1BH</td><td style="text-align:center">4</td><td style="text-align:center">长整数</td><td style="text-align:center">采样频率</td></tr><tr><td style="text-align:center">1CH~1FH</td><td style="text-align:center">4</td><td style="text-align:center">长整数</td><td style="text-align:center">波形数据传输速率（每秒平均字节数）</td></tr><tr><td style="text-align:center">20H~21H</td><td style="text-align:center">2</td><td style="text-align:center">整数</td><td style="text-align:center">DATA数据块长度，字节</td></tr><tr><td style="text-align:center">22H~23H</td><td style="text-align:center">2</td><td style="text-align:center">整数</td><td style="text-align:center">PCM位宽</td></tr><tr><td style="text-align:center">24H~27H</td><td style="text-align:center">4</td><td style="text-align:center">4字符</td><td style="text-align:center">“fact”,该部分一下是可选部分，即可能有，可能没有</td></tr><tr><td style="text-align:center">28H~2BH</td><td style="text-align:center">4</td><td style="text-align:center">长整数</td><td style="text-align:center">size,数值为4</td></tr></tbody></table><p>关于WAV文件尾需要特别强调</p><p>有些文件是添加了结尾的<code>&lt;LIST&gt;</code>这样开头的文件尾的，包含了一些录制的公司的信息，日期，等等…<br>所以对于这样的文件尾还是需要做相应的处理..<br>总的来说，提取真实有效的数据段就好了（剔除头和尾）。</p><p>当然，在我的实验中，我采取的方式是，将8bit的数据段提取出来后，放进这样一个数组里面。</p><pre class="line-numbers language-c"><code class="language-c"><span class="token keyword">const</span> <span class="token keyword">unsigned</span> <span class="token keyword">char</span> datap<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>这样，编译的时候，这个数组的区域自然会被编译器放到FLASH当中。当然，也可以不放在flash中，因为实在太占空间了。<br>会有更好的办法，这是后话，待会儿再说。</p><p>当然，有的盆友就不明白了，都看不到这个数据，怎么提取…<br>别担心，当然有好用的工具啦..</p><p><img src="https://s2.ax1x.com/2019/02/20/kgxNHf.jpg" class="img-shadow"></p><p><a href="https://www.proxoft.com/BinaryViewer.aspx" target="_blank" rel="noopener">Binary Viewer</a>，这是一个在windows环境中的一个以二进制查看文件的工具，能够显示偏移量，hex，ascii，格式化输出等等..<br>可以自定义数据输出格式的功能也是很棒，并且这个软件才1.8M。</p><p>能看数据了，还不够，这样看数据来识别WAV文件是什么采样率，什么bit位，都太不直观了..<br>于是又有<a href="https://mediaarea.net/en/MediaInfo" target="_blank" rel="noopener">mediainfo</a>这个软件,能够显示WAV文件的详细信息.采样率,量化bit什么都看到了..</p><p>所以你觉得有了这些就够了吗？ 不！<br>还有个最重要的软件，<a href="https://www.adobe.com/cn/products/audition.html" target="_blank" rel="noopener">Audition</a>。<br>这个软件不仅能够修改WAV的采样频率，还能修改量化bit的大小，简直就是个神器。重要的是,能够看到每个采样点的波形点…<br>简直…太棒辣..</p><h2 id="解码！PWM来模拟DA输出"><a href="#解码！PWM来模拟DA输出" class="headerlink" title="解码！PWM来模拟DA输出"></a>解码！PWM来模拟DA输出</h2><hr><p>现在开始说PWM模拟DA输出。对于玩过单片机的人来说，PWM并不陌生，即，脉冲宽度调制。实际上PWM出来的，是一个方波。<br>大家都知道，但是它有一个周期，所以有周期，那么就有频率了。好，请记住此处是PWM频率！与之前所说的音频采样频率不是同一个东西。</p><p>那么占空比是什么呢？占空比就是在一个方波周期内，高电平脉冲宽度所占有周期的百分比..也不能说是百分比，总之就是那个意思了…<br>如果把一个周期分成0xff份，那0x01，高电平就占有1/255的周期时间。那么使用这个比例去设置电压，假设所使用的单片机使用的是5V电压基准，那么设置占空比0x01，则</p><blockquote><p>5V/255*1 = 0.019607843137255V </p></blockquote><p>所以现在你算出来，把PWM周期分成255份，然后将占空比设置为1/255。<br>现在拿万用表量一下，现在PWM输出的电压值是不是0.019607843137255V。<br>对吧,没错吧…<br>那么再试试将占空比设置为128，再用万用表测量一下…<br>对吧，2.5V有了吧..</p><p>这样，我们就能够使用PWM模拟DA输出了。既然这样能够调节占空比来输出不同的电压了，那么我们应该使用什么样的频率来输出PWM呢？<br>当然是结合MCU的频率，高于WAV文件的采样频率更好更好。之前看了别的文章，说是两倍于采样频率即可（我的实验中采用两倍）。<br>到这个地方，请记住，这个PWM频率，是用来产生模拟DA电压的频率，不是播放音频文件的频率或音频文件的采样频率！</p><p>那么我们播放音频文件到底使用什么样的节奏(频率)呢？<br>当然是使用采用频率啦，不然播放出来的音乐总感觉哪里不对，要么就是一片杂音。<br>为了达到准确的播放频率，那就取决于我们定时器中断的时间了。<br>比如，1000us进一次中断,那么我们播放音频文件的频率就是1kHz。<br>如果我们的WAV文件的采样率是1kHz，且数据位是8bit。<br>那么每次进中断（此处的中断，使用的是定时器中断）的时候，就按照8bit的数据，调整不同的占空比。</p><p><img src="https://s2.ax1x.com/2019/02/20/kgxaE8.jpg" class="img-shadow"></p><p>1000us改变一次电压，就在横纵坐标(横轴是时间,纵轴是电压)。<br>这样一个一个时间-电压点打出来，就在横纵坐标上画出来了音频文件的曲线。<br>用<a href="https://www.adobe.com/cn/products/audition.html" target="_blank" rel="noopener">Audition</a>打开所播放的音频波形和画出来的音频曲线大概对比一下就能发现，图像是一模一样的…<br>好，现在应该就能够听见喇叭出来的每秒的声音了吧..</p><p>当输入的模拟信号上限频率为 fc，只要取样脉冲 us（t）的重复频率 fs不低于 fc<br>的两倍，总可以无失真地由取样后的离散信号恢复出原来的模拟信号，即不失真输出条件为：</p><blockquote><p>fs≥2fc （2.1）</p></blockquote><h2 id="硬件怎么设计"><a href="#硬件怎么设计" class="headerlink" title="硬件怎么设计"></a>硬件怎么设计</h2><hr><p>MCU引脚—-&gt;功放—&gt;滤波器—&gt;喇叭。<br>Google一下，网络上很多很多的示范电路…<br>我就不贴图了，对。<br>是因为我…..<br><del>懒!</del></p><p>关于之前提到的，不要存flash里面的问题。不够用当然要想办法，用SD卡吧,SPI读写,毕竟大多数人都是这么干的..<br>有时候从众也不是一件坏事..</p><h2 id="つづく"><a href="#つづく" class="headerlink" title="つづく"></a>つづく</h2><hr><p>是，没错，我用MCU放了一首张学友的《爱我别走》。<br>音质，简直毁了…<br>对于想做得更考究的朋友，除了在硬件上需要有所优化。<br>在软件上需要使用更高采样率的音频源（44.1k）。</p><p>另外还有一种玩法，就是从PCM的原始数据（WAV）上着手，使用算法将midi的音算出来。这种玩法的好处是，<br>非常节省资源，非常适合在MCU等资源紧缺的器件上使用。</p><h2 id="参考文献"><a href="#参考文献" class="headerlink" title="参考文献"></a>参考文献</h2><p>1.毕厚杰,《新一代视频压缩编码标准——H.264/AVC》，人民邮电出版社，2009，2.1.2,数字电视的 PCM 原理</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;img src=&quot;https://s2.ax1x.com/2019/02/20/kgvqhQ.png&quot; class=&quot;img-shadow&quot;&gt;&lt;/p&gt;
&lt;p&gt;通常使用三个参数来表示声音，&lt;code&gt;量化位数&lt;/code&gt;、&lt;code&gt;取样频率&lt;/code&gt;、&lt;code&gt;采
      
    
    </summary>
    
      <category term="技术" scheme="https://www.j2kly.com/categories/%E6%8A%80%E6%9C%AF/"/>
    
    
      <category term="MCU" scheme="https://www.j2kly.com/tags/MCU/"/>
    
      <category term="Midi" scheme="https://www.j2kly.com/tags/Midi/"/>
    
  </entry>
  
  <entry>
    <title>人生拉清单</title>
    <link href="https://www.j2kly.com/2019/02/13/%E4%BA%BA%E7%94%9F%E6%8B%89%E6%B8%85%E5%8D%95/"/>
    <id>https://www.j2kly.com/2019/02/13/人生拉清单/</id>
    <published>2019-02-13T12:45:01.000Z</published>
    <updated>2021-02-07T09:07:06.334Z</updated>
    
    <content type="html"><![CDATA[<iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width="330" height="86" src="//music.163.com/outchain/player?type=2&id=27575590&auto=1&height=66"></iframe><p>这里是这辈子需要做的事情,做到的打钩 √,没做到的打叉 x</p><p>一辈子想做的事情好多好多,我怕到时候都忘记，所以记下来，一次肯定写不完，所以我选择慢慢补充。<br><br><br></p><table><thead><tr><th style="text-align:center">愿望</th><th style="text-align:center">True?</th><th style="text-align:center">备注</th></tr></thead><tbody><tr><td style="text-align:center">去日本看一次樱花</td><td style="text-align:center">x</td><td style="text-align:center">暂无计划</td></tr><tr><td style="text-align:center">去一次南极和企鹅玩</td><td style="text-align:center">x</td><td style="text-align:center">暂无计划</td></tr><tr><td style="text-align:center">从成都骑车去一次拉萨</td><td style="text-align:center">x</td><td style="text-align:center">暂无计划</td></tr><tr><td style="text-align:center">到巴黎的埃菲尔铁塔拍张照片</td><td style="text-align:center">x</td><td style="text-align:center">暂无计划</td></tr><tr><td style="text-align:center">到凯旋门拍一张照片</td><td style="text-align:center">x</td><td style="text-align:center">暂无计划</td></tr><tr><td style="text-align:center">在波尔多去吃次牛排 &amp;&amp; 和葡萄酒</td><td style="text-align:center">x</td><td style="text-align:center">暂无计划</td></tr><tr><td style="text-align:center">攀登珠峰</td><td style="text-align:center">x</td><td style="text-align:center">被无数人否决，因为危险，暂无计划</td></tr><tr><td style="text-align:center">到巴黎的埃菲尔铁塔拍张照片</td><td style="text-align:center">x</td><td style="text-align:center">暂无计划</td></tr><tr><td style="text-align:center">去全中国的省会城市一次，需要集齐34个</td><td style="text-align:center">x</td><td style="text-align:center">部分执行完成</td></tr><tr><td style="text-align:center">北京</td><td style="text-align:center">√</td><td style="text-align:center"></td></tr><tr><td style="text-align:center">天津</td><td style="text-align:center">x</td><td style="text-align:center"></td></tr><tr><td style="text-align:center">上海</td><td style="text-align:center">√</td><td style="text-align:center">最近上海好热</td></tr><tr><td style="text-align:center">重庆</td><td style="text-align:center">√</td><td style="text-align:center"></td></tr><tr><td style="text-align:center">河北</td><td style="text-align:center">x</td><td style="text-align:center"></td></tr><tr><td style="text-align:center">山西</td><td style="text-align:center">x</td><td style="text-align:center"></td></tr><tr><td style="text-align:center">陕西</td><td style="text-align:center">x</td><td style="text-align:center"></td></tr><tr><td style="text-align:center">山东</td><td style="text-align:center">x</td><td style="text-align:center"></td></tr><tr><td style="text-align:center">河南</td><td style="text-align:center">x</td><td style="text-align:center"></td></tr><tr><td style="text-align:center">辽宁</td><td style="text-align:center">x</td><td style="text-align:center"></td></tr><tr><td style="text-align:center">吉林</td><td style="text-align:center">x</td><td style="text-align:center"></td></tr><tr><td style="text-align:center">黑龙江</td><td style="text-align:center">x</td><td style="text-align:center"></td></tr><tr><td style="text-align:center">江苏</td><td style="text-align:center">√</td><td style="text-align:center"></td></tr><tr><td style="text-align:center">浙江</td><td style="text-align:center">√</td><td style="text-align:center"></td></tr><tr><td style="text-align:center">安徽</td><td style="text-align:center">√</td><td style="text-align:center"></td></tr><tr><td style="text-align:center">江西</td><td style="text-align:center">x</td><td style="text-align:center"></td></tr><tr><td style="text-align:center">福建</td><td style="text-align:center">x</td><td style="text-align:center"></td></tr><tr><td style="text-align:center">湖北</td><td style="text-align:center">√</td><td style="text-align:center"></td></tr><tr><td style="text-align:center">湖南</td><td style="text-align:center">x</td><td style="text-align:center"></td></tr><tr><td style="text-align:center">四川</td><td style="text-align:center">x</td><td style="text-align:center"></td></tr><tr><td style="text-align:center">贵州</td><td style="text-align:center">x</td><td style="text-align:center"></td></tr><tr><td style="text-align:center">云南</td><td style="text-align:center">x</td><td style="text-align:center"></td></tr><tr><td style="text-align:center">广东</td><td style="text-align:center">x</td><td style="text-align:center"></td></tr><tr><td style="text-align:center">海南</td><td style="text-align:center">x</td><td style="text-align:center"></td></tr><tr><td style="text-align:center">甘肃</td><td style="text-align:center">x</td><td style="text-align:center"></td></tr><tr><td style="text-align:center">青海</td><td style="text-align:center">x</td><td style="text-align:center"></td></tr><tr><td style="text-align:center">台湾</td><td style="text-align:center">√</td><td style="text-align:center"></td></tr><tr><td style="text-align:center">内蒙古</td><td style="text-align:center">x</td><td style="text-align:center"></td></tr><tr><td style="text-align:center">新疆</td><td style="text-align:center">x</td><td style="text-align:center"></td></tr><tr><td style="text-align:center">西藏</td><td style="text-align:center">x</td><td style="text-align:center"></td></tr><tr><td style="text-align:center">广西</td><td style="text-align:center">x</td><td style="text-align:center"></td></tr><tr><td style="text-align:center">宁夏</td><td style="text-align:center">x</td><td style="text-align:center"></td></tr><tr><td style="text-align:center">香港</td><td style="text-align:center">x</td><td style="text-align:center"></td></tr><tr><td style="text-align:center">澳门</td><td style="text-align:center">x</td><td style="text-align:center"></td></tr><tr><td style="text-align:center">从2016年起,每年过年和朋友一起吃顿饭,一年打一次√,没有次数限制</td><td style="text-align:center">x</td><td style="text-align:center"></td></tr><tr><td style="text-align:center">2016年</td><td style="text-align:center">√</td><td style="text-align:center"></td></tr><tr><td style="text-align:center">2017年</td><td style="text-align:center">√</td><td style="text-align:center"></td></tr><tr><td style="text-align:center">2018年</td><td style="text-align:center">√</td><td style="text-align:center"></td></tr><tr><td style="text-align:center">2019年</td><td style="text-align:center">√</td><td style="text-align:center"></td></tr><tr><td style="text-align:center">2020年</td><td style="text-align:center">√</td><td style="text-align:center"></td></tr><tr><td style="text-align:center">彻底学会linux系统移植</td><td style="text-align:center">x</td><td style="text-align:center">一块心病</td></tr><tr><td style="text-align:center">从2012年开始算起,撸至少25年以上的代码</td><td style="text-align:center">x</td><td style="text-align:center">这辈子悲剧了</td></tr><tr><td style="text-align:center">2012年</td><td style="text-align:center">√</td><td style="text-align:center">+1</td></tr><tr><td style="text-align:center">2013年</td><td style="text-align:center">√</td><td style="text-align:center">+2</td></tr><tr><td style="text-align:center">2014年</td><td style="text-align:center">√</td><td style="text-align:center">+3</td></tr><tr><td style="text-align:center">2015年</td><td style="text-align:center">√</td><td style="text-align:center">+4</td></tr><tr><td style="text-align:center">2016年</td><td style="text-align:center">√</td><td style="text-align:center">+5</td></tr><tr><td style="text-align:center">2017年</td><td style="text-align:center">√</td><td style="text-align:center">+6</td></tr><tr><td style="text-align:center">2018年</td><td style="text-align:center">√</td><td style="text-align:center">+7</td></tr><tr><td style="text-align:center">2019年</td><td style="text-align:center">√</td><td style="text-align:center">+8</td></tr><tr><td style="text-align:center">2020年</td><td style="text-align:center">√</td><td style="text-align:center">+9</td></tr><tr><td style="text-align:center">成为嵌入式软件工程师</td><td style="text-align:center">√</td><td style="text-align:center">完全习得</td></tr><tr><td style="text-align:center">月入一狗</td><td style="text-align:center">√</td><td style="text-align:center">2020.08实现</td></tr><tr><td style="text-align:center">在重庆\成都\南京\上海 其中一座城市买一套房子</td><td style="text-align:center">x</td><td style="text-align:center">预计于2020年在成都购买</td></tr><tr><td style="text-align:center">买一辆三菱或者高尔夫</td><td style="text-align:center">x</td><td style="text-align:center">预计2023年购买</td></tr><tr><td style="text-align:center">再去台湾岛浪一圈</td><td style="text-align:center">x</td><td style="text-align:center">穷，玩不起</td></tr><tr><td style="text-align:center">在有生之年内,使用&lt;好想急死你&gt;的op当手机铃声</td><td style="text-align:center">x</td><td style="text-align:center">已放弃</td></tr><tr><td style="text-align:center">买一辆川崎ninja400</td><td style="text-align:center">x</td><td style="text-align:center">等待学习摩托车驾照</td></tr><tr><td style="text-align:center">…</td><td style="text-align:center">x</td><td style="text-align:center">未完待续</td></tr></tbody></table><p><br><br><br>时常感到孤独,因为是独自一人，难过难过就好，就像有人说的每个人都有那么一段孤独的时期吧。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;iframe frameborder=&quot;no&quot; border=&quot;0&quot; marginwidth=&quot;0&quot; marginheight=&quot;0&quot; width=&quot;330&quot; height=&quot;86&quot; src=&quot;//music.163.com/outchain/player?type=2&amp;id=
      
    
    </summary>
    
      <category term="修身" scheme="https://www.j2kly.com/categories/%E4%BF%AE%E8%BA%AB/"/>
    
    
  </entry>
  
</feed>
